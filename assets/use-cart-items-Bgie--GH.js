import{H as S,I as w,P as _,J as p,c as I,L as v}from"./index-DC6gCUyc.js";import{u as g,b as $,a as C}from"./tanstack-BOxH6YKw.js";const l=S(),y=w(),m="cart",q={itemId:"A",discount:"B",quantity:"C",cartId:"D"},f=async e=>{if(!l||!y)return[];const t=`https://sheets.googleapis.com/v4/spreadsheets/${l}/values/${m}?key=${y}`;return(await(await fetch(t,{signal:e})).json()).values.slice(1).map(n=>({itemId:n[0],discount:n[1],quantity:n[2],cartId:n[3]}))},h=async(e,t,s)=>{const o=(await f()).findIndex(n=>n.itemId===e);if(o!==-1){const n={values:[[s]]},c=`${m}!${q[t]}${o+2}`,r=`https://sheets.googleapis.com/v4/spreadsheets/${l}/values/${c}?valueInputOption=RAW&key=${y}`;await p(r,{body:JSON.stringify(n),method:"PUT"})}},Q=async e=>{const t=await f(),s=[];if(t.forEach((r,u)=>{r.itemId!==void 0&&r.itemId.startsWith(_)&&s.push(`${m}!A${u+2}:F${u+2}`)}),s.length){const r=`https://sheets.googleapis.com/v4/spreadsheets/${l}/values:batchClear?key=${y}`;await p(r,{method:"POST",body:JSON.stringify({ranges:s})})}const o={values:e.map(r=>[r,"0","1","1"])},n=`${m}!A1`,c=`https://sheets.googleapis.com/v4/spreadsheets/${l}/values/${n}:append?valueInputOption=RAW&key=${y}`;await p(c,{body:JSON.stringify(o),method:"POST"})},P=async e=>{const s=(await f()).findIndex(a=>a.itemId===e);if(s!==-1){const a=`${m}!A${s+2}:F${s+2}`,o=`https://sheets.googleapis.com/v4/spreadsheets/${l}/values/${a}:clear?key=${y}`;await p(o,{method:"POST"})}},E=async e=>{const t=await f(),s=t.findIndex(a=>a.itemId===e);if(s===-1){const a={values:[[e,"0","1","1"]]},o=`${m}!A1`,n=`https://sheets.googleapis.com/v4/spreadsheets/${l}/values/${o}:append?valueInputOption=RAW&key=${y}`;await p(n,{body:JSON.stringify(a),method:"POST"})}else{const a=t[s],n={values:[[parseInt(a.quantity,10)+1]]},c=`${m}!${q.quantity}${s+2}`,r=`https://sheets.googleapis.com/v4/spreadsheets/${l}/values/${c}?valueInputOption=RAW&key=${y}`;await p(r,{body:JSON.stringify(n),method:"PUT"})}},i=()=>[v],A=()=>{const e=I.c(1);let t;return e[0]===Symbol.for("react.memo_cache_sentinel")?(t={staleTime:21e5,queryKey:i(),queryFn:D},e[0]=t):t=e[0],C(t)},N=()=>{const e=I.c(2),t=g();let s;return e[0]!==t?(s={async onSettled(){return await t.invalidateQueries({queryKey:i()})},onMutate:async a=>{const{itemId:o,quantity:n,discount:c}=a;await t.cancelQueries({queryKey:i()});const r=t.getQueryData(i())||[],u=r.map(d=>d.itemId!==o?d:{...d,quantity:n!==void 0?n:d.quantity,discount:c!==void 0?c:d.discount});return t.setQueryData(i(),u),{list:r}},onError:(a,o,n)=>{t.setQueryData([i()],n?.list)},mutationFn:T},e[0]=t,e[1]=s):s=e[1],$(s)},W=()=>{const e=I.c(2),t=g();let s;return e[0]!==t?(s={async onSettled(){return await t.invalidateQueries({queryKey:[v]})},onMutate:async a=>{const{itemIds:o}=a;await t.cancelQueries({queryKey:i()});const n=t.getQueryData(i())||[];return t.setQueryData(i(),c=>{const u=(c===void 0?[]:c).filter(K),d=o.map(R);return[...u,...d]}),{list:n}},onError:(a,o,n)=>{t.setQueryData([i()],n?.list)},mutationFn:x},e[0]=t,e[1]=s):s=e[1],$(s)},M=()=>{const e=I.c(2),t=g();let s;return e[0]!==t?(s={async onSettled(){return await t.invalidateQueries({queryKey:[v]})},onMutate:async a=>{const{itemId:o,action:n}=a;await t.cancelQueries({queryKey:i()});const c=t.getQueryData(i())||[];return n==="remove"&&t.setQueryData(i(),r=>r?.filter(u=>u.itemId!==o)),n==="add"&&t.setQueryData(i(),r=>r?.find(d=>d.itemId===o)?r:[...r||[],{itemId:o,quantity:"1",discount:"0",cartId:"1"}]),{list:c}},onError:(a,o,n)=>{t.setQueryData([i()],n?.list)},mutationFn:F},e[0]=t,e[1]=s):s=e[1],$(s)};function O(e){return!!e.itemId}function b(e){return e.filter(O)}function D(e){const{signal:t}=e;return f(t).then(b)}async function T(e){const{discount:t,quantity:s,itemId:a}=e;t!==void 0&&await h(a,"discount",t),s!==void 0&&await h(a,"quantity",s)}function K(e){return!e.itemId.startsWith(_)}function R(e){return{itemId:e,quantity:"1",discount:"0",cartId:"1"}}function x(e){const{itemIds:t}=e;return Q(t)}function F(e){const{itemId:t,action:s}=e;return s==="add"?E(t):s==="remove"?P(t):Promise.resolve()}const H=()=>{const e=I.c(2),{data:t}=A();let s;return e[0]!==t?(s=t===void 0?[]:t,e[0]=t,e[1]=s):s=e[1],s};export{M as a,H as b,W as c,N as u};
