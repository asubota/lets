import{G as S,H as w,P as _,I as p,c as I,K as v}from"./index-Lq56JmxE.js";import{u as g,b as $,a as C}from"./tanstack-n9UxjfaS.js";const y=S(),l=w(),m="cart",q={itemId:"A",discount:"B",quantity:"C",cartId:"D"},f=async e=>{if(!y||!l)return[];const t=`https://sheets.googleapis.com/v4/spreadsheets/${y}/values/${m}?key=${l}`;return(await(await fetch(t,{signal:e})).json()).values.slice(1).map(n=>({itemId:n[0],discount:n[1],quantity:n[2],cartId:n[3]}))},h=async(e,t,s)=>{const i=(await f()).findIndex(n=>n.itemId===e);if(i!==-1){const n={values:[[s]]},u=`${m}!${q[t]}${i+2}`,r=`https://sheets.googleapis.com/v4/spreadsheets/${y}/values/${u}?valueInputOption=RAW&key=${l}`;await p(r,{body:JSON.stringify(n),method:"PUT"})}},Q=async e=>{const t=await f(),s=[];if(t.forEach((r,c)=>{r.itemId!==void 0&&r.itemId.startsWith(_)&&s.push(`${m}!A${c+2}:F${c+2}`)}),s.length){const r=`https://sheets.googleapis.com/v4/spreadsheets/${y}/values:batchClear?key=${l}`;await p(r,{method:"POST",body:JSON.stringify({ranges:s})})}const i={values:e.map(r=>[r,"0","1","1"])},n=`${m}!A1`,u=`https://sheets.googleapis.com/v4/spreadsheets/${y}/values/${n}:append?valueInputOption=RAW&key=${l}`;await p(u,{body:JSON.stringify(i),method:"POST"})},P=async e=>{const s=(await f()).findIndex(a=>a.itemId===e);if(s!==-1){const a=`${m}!A${s+2}:F${s+2}`,i=`https://sheets.googleapis.com/v4/spreadsheets/${y}/values/${a}:clear?key=${l}`;await p(i,{method:"POST"})}},E=async e=>{const t=await f(),s=t.findIndex(a=>a.itemId===e);if(s===-1){const a={values:[[e,"0","1","1"]]},i=`${m}!A1`,n=`https://sheets.googleapis.com/v4/spreadsheets/${y}/values/${i}:append?valueInputOption=RAW&key=${l}`;await p(n,{body:JSON.stringify(a),method:"POST"})}else{const a=t[s],n={values:[[parseInt(a.quantity,10)+1]]},u=`${m}!${q.quantity}${s+2}`,r=`https://sheets.googleapis.com/v4/spreadsheets/${y}/values/${u}?valueInputOption=RAW&key=${l}`;await p(r,{body:JSON.stringify(n),method:"PUT"})}},o=()=>[v],A=()=>{const e=I.c(1);let t;return e[0]===Symbol.for("react.memo_cache_sentinel")?(t={staleTime:21e5,queryKey:o(),queryFn:D},e[0]=t):t=e[0],C(t)},J=()=>{const e=I.c(2),t=g();let s;return e[0]!==t?(s={async onSettled(){return await t.invalidateQueries({queryKey:o()})},onMutate:async a=>{const{itemId:i,quantity:n,discount:u}=a;await t.cancelQueries({queryKey:o()});const r=t.getQueryData(o())||[],c=r.map(d=>d.itemId!==i?d:{...d,quantity:n!==void 0?n:d.quantity,discount:u!==void 0?u:d.discount});return t.setQueryData(o(),c),{list:r}},onError:(a,i,n)=>{t.setQueryData([o()],n==null?void 0:n.list)},mutationFn:K},e[0]=t,e[1]=s):s=e[1],$(s)},M=()=>{const e=I.c(2),t=g();let s;return e[0]!==t?(s={async onSettled(){return await t.invalidateQueries({queryKey:[v]})},onMutate:async a=>{const{itemIds:i}=a;await t.cancelQueries({queryKey:o()});const n=t.getQueryData(o())||[];return t.setQueryData(o(),u=>{const c=(u===void 0?[]:u).filter(T),d=i.map(R);return[...c,...d]}),{list:n}},onError:(a,i,n)=>{t.setQueryData([o()],n==null?void 0:n.list)},mutationFn:F},e[0]=t,e[1]=s):s=e[1],$(s)},G=()=>{const e=I.c(2),t=g();let s;return e[0]!==t?(s={async onSettled(){return await t.invalidateQueries({queryKey:[v]})},onMutate:async a=>{const{itemId:i,action:n}=a;await t.cancelQueries({queryKey:o()});const u=t.getQueryData(o())||[];return n==="remove"&&t.setQueryData(o(),r=>r==null?void 0:r.filter(c=>c.itemId!==i)),n==="add"&&t.setQueryData(o(),r=>(r==null?void 0:r.find(d=>d.itemId===i))?r:[...r||[],{itemId:i,quantity:"1",discount:"0",cartId:"1"}]),{list:u}},onError:(a,i,n)=>{t.setQueryData([o()],n==null?void 0:n.list)},mutationFn:k},e[0]=t,e[1]=s):s=e[1],$(s)};function O(e){return!!e.itemId}function b(e){return e.filter(O)}function D(e){const{signal:t}=e;return f(t).then(b)}async function K(e){const{discount:t,quantity:s,itemId:a}=e;t!==void 0&&await h(a,"discount",t),s!==void 0&&await h(a,"quantity",s)}function T(e){return!e.itemId.startsWith(_)}function R(e){return{itemId:e,quantity:"1",discount:"0",cartId:"1"}}function F(e){const{itemIds:t}=e;return Q(t)}function k(e){const{itemId:t,action:s}=e;return s==="add"?E(t):s==="remove"?P(t):Promise.resolve()}const H=()=>{const e=I.c(2),{data:t}=A();let s;return e[0]!==t?(s=t===void 0?[]:t,e[0]=t,e[1]=s):s=e[1],s};export{G as a,H as b,M as c,J as u};
