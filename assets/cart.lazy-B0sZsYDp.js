import{j as t,r as j,d as B,s as G}from"./tanstack-DrrzDSOT.js";import{d as F,B as u,Q as N,M as K,a as T,o as Q,p as _,R as J,x as X,I as D,g as $,e as E,m as Z}from"./mui-DpcCcPuz.js";import{c as tt,A as nt,H,b as et,u as st,f as ot,D as it}from"./index-CvWbQ8Kj.js";import{u as R,a as ct,b as rt}from"./cart-api-CrpjopF9.js";import"./react-_uqhELNW.js";import"./html2canvas-BfYXEYrK.js";import"./tesseract-efYOn2sj.js";import"./swiper-B72pzicN.js";const at=F(t.jsx("path",{d:"M19 13H5v-2h14z"}),"Remove"),lt=F(t.jsx("path",{d:"M22.73 22.73 2.77 2.77 2 2l-.73-.73L0 2.54l4.39 4.39 2.21 4.66-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h7.46l1.38 1.38c-.5.36-.83.95-.83 1.62 0 1.1.89 2 1.99 2 .67 0 1.26-.33 1.62-.84L21.46 24zM7.42 15c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h2.36l2 2zm8.13-2c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H6.54zM7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2"}),"RemoveShoppingCart"),ut="Left",dt="Right",pt="Up",ht="Down",S={delta:10,preventScrollOnSwipe:!1,rotationAngle:0,trackMouse:!1,trackTouch:!0,swipeDuration:1/0,touchEventOptions:{passive:!0}},k={first:!0,initial:[0,0],start:0,swiping:!1,xy:[0,0]},z="mousemove",A="mouseup",xt="touchend",mt="touchmove",ft="touchstart";function gt(n,c,r,i){return n>c?r>0?dt:ut:i>0?ht:pt}function P(n,c){if(c===0)return n;const r=Math.PI/180*c,i=n[0]*Math.cos(r)+n[1]*Math.sin(r),p=n[1]*Math.cos(r)-n[0]*Math.sin(r);return[i,p]}function jt(n,c){const r=e=>{const s="touches"in e;s&&e.touches.length>1||n((o,a)=>{a.trackMouse&&!s&&(document.addEventListener(z,i),document.addEventListener(A,m));const{clientX:f,clientY:g}=s?e.touches[0]:e,b=P([f,g],a.rotationAngle);return a.onTouchStartOrOnMouseDown&&a.onTouchStartOrOnMouseDown({event:e}),Object.assign(Object.assign(Object.assign({},o),k),{initial:b.slice(),xy:b,start:e.timeStamp||0})})},i=e=>{n((s,o)=>{const a="touches"in e;if(a&&e.touches.length>1)return s;if(e.timeStamp-s.start>o.swipeDuration)return s.swiping?Object.assign(Object.assign({},s),{swiping:!1}):s;const{clientX:f,clientY:g}=a?e.touches[0]:e,[b,M]=P([f,g],o.rotationAngle),w=b-s.xy[0],O=M-s.xy[1],v=Math.abs(w),y=Math.abs(O),C=(e.timeStamp||0)-s.start,V=Math.sqrt(v*v+y*y)/(C||1),Y=[w/(C||1),O/(C||1)],L=gt(v,y,w,O),U=typeof o.delta=="number"?o.delta:o.delta[L.toLowerCase()]||S.delta;if(v<U&&y<U&&!s.swiping)return s;const I={absX:v,absY:y,deltaX:w,deltaY:O,dir:L,event:e,first:s.first,initial:s.initial,velocity:V,vxvy:Y};I.first&&o.onSwipeStart&&o.onSwipeStart(I),o.onSwiping&&o.onSwiping(I);let W=!1;return(o.onSwiping||o.onSwiped||o[`onSwiped${L}`])&&(W=!0),W&&o.preventScrollOnSwipe&&o.trackTouch&&e.cancelable&&e.preventDefault(),Object.assign(Object.assign({},s),{first:!1,eventData:I,swiping:!0})})},p=e=>{n((s,o)=>{let a;if(s.swiping&&s.eventData){if(e.timeStamp-s.start<o.swipeDuration){a=Object.assign(Object.assign({},s.eventData),{event:e}),o.onSwiped&&o.onSwiped(a);const f=o[`onSwiped${a.dir}`];f&&f(a)}}else o.onTap&&o.onTap({event:e});return o.onTouchEndOrOnMouseUp&&o.onTouchEndOrOnMouseUp({event:e}),Object.assign(Object.assign(Object.assign({},s),k),{eventData:a})})},d=()=>{document.removeEventListener(z,i),document.removeEventListener(A,m)},m=e=>{d(),p(e)},h=(e,s)=>{let o=()=>{};if(e&&e.addEventListener){const a=Object.assign(Object.assign({},S.touchEventOptions),s.touchEventOptions),f=[[ft,r,a],[mt,i,Object.assign(Object.assign({},a),s.preventScrollOnSwipe?{passive:!1}:{})],[xt,p,a]];f.forEach(([g,b,M])=>e.addEventListener(g,b,M)),o=()=>f.forEach(([g,b])=>e.removeEventListener(g,b))}return o},l={ref:e=>{e!==null&&n((s,o)=>{if(s.el===e)return s;const a={};return s.el&&s.el!==e&&s.cleanUpTouch&&(s.cleanUpTouch(),a.cleanUpTouch=void 0),o.trackTouch&&e&&(a.cleanUpTouch=h(e,o)),Object.assign(Object.assign(Object.assign({},s),{el:e}),a)})}};return c.trackMouse&&(l.onMouseDown=r),[l,h]}function bt(n,c,r,i){return!c.trackTouch||!n.el?(n.cleanUpTouch&&n.cleanUpTouch(),Object.assign(Object.assign({},n),{cleanUpTouch:void 0})):n.cleanUpTouch?c.preventScrollOnSwipe!==r.preventScrollOnSwipe||c.touchEventOptions.passive!==r.touchEventOptions.passive?(n.cleanUpTouch(),Object.assign(Object.assign({},n),{cleanUpTouch:i(n.el,c)})):n:Object.assign(Object.assign({},n),{cleanUpTouch:i(n.el,c)})}function St(n){const{trackMouse:c}=n,r=j.useRef(Object.assign({},k)),i=j.useRef(Object.assign({},S)),p=j.useRef(Object.assign({},i.current));p.current=Object.assign({},i.current),i.current=Object.assign(Object.assign({},S),n);let d;for(d in S)i.current[d]===void 0&&(i.current[d]=S[d]);const[m,h]=j.useMemo(()=>jt(x=>r.current=x(r.current,i.current),{trackMouse:c}),[c]);return r.current=bt(r.current,i.current,p.current,h),m}const vt="ontouchstart"in window||navigator.maxTouchPoints>0,yt=({children:n,actions:c})=>{const[r,i]=j.useState(!1),m=St({onSwipedLeft:()=>i(!0),onSwipedRight:()=>i(!1),preventScrollOnSwipe:!0}),h=j.useRef(null);j.useEffect(()=>{const l=e=>{h.current&&!h.current.contains(e.target)&&i(!1)};return document.addEventListener("mousedown",l),()=>{document.removeEventListener("mousedown",l)}},[]);const x=l=>{m.ref(l),h.current=l};return t.jsxs(u,{...m,ref:x,sx:{position:"relative",overflow:"hidden",mb:2,"&:hover .top-actions":{display:"block"}},children:[t.jsx(u,{sx:{flex:1},children:n}),!vt&&t.jsx(u,{className:"top-actions",sx:{display:"none",position:"absolute",right:0,top:0},children:c}),t.jsx(u,{sx:{position:"absolute",right:0,top:0,bottom:0,display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"flex-end",transition:"transform 0.3s ease",transform:r?"translateX(0)":"translateX(100%)"},children:c})]})},q=n=>`${n}%`,wt=({discount:n,fullPrice:c,itemId:r})=>{const{mutate:i}=R(),[p,d]=j.useState(null),m=f=>{d(f.currentTarget)},h=()=>{l!==n&&i({itemId:r,discount:String(l)}),d(null)},x=!!p,[l,e]=j.useState(n),s=(f,g)=>{e(g)},o=c*l/100,a=c-o;return t.jsxs(t.Fragment,{children:[t.jsx(u,{sx:{cursor:"pointer"},onClick:m,children:"Знижка:"}),t.jsx(N,{closeAfterTransition:!0,open:x,anchorEl:p,onClose:h,anchorOrigin:{vertical:"center",horizontal:"right"},transformOrigin:{vertical:"center",horizontal:"left"},children:t.jsxs(u,{sx:{m:"24px",mb:"4px",mt:"28px"},children:[t.jsx(K,{size:"small",valueLabelDisplay:"on",step:1,marks:!0,min:0,max:15,track:!1,value:l,onChange:s,getAriaValueText:q,valueLabelFormat:q,sx:{"& .MuiSlider-valueLabel":{backgroundColor:"primary.main",p:"4px",pt:"2px",pb:0},"& .MuiSlider-valueLabelLabel":{fontWeight:"bold",fontSize:"12px"}}}),t.jsxs(T,{variant:"body2",children:["Повна ціна: ",c," грн"]}),t.jsxs(T,{variant:"body2",sx:{fontWeight:"bold",color:"success.main"},children:["Ціна зі знижкою: ",a.toFixed(2)," грн"]}),t.jsxs(T,{variant:"body2",sx:{fontWeight:"bold",color:"primary.main"},children:["Знижка: ",Math.ceil(o)," грн"]})]})})]})},Ot=({itemId:n,discount:c})=>{const{mutate:r}=R(),{register:i,handleSubmit:p,setValue:d}=tt({defaultValues:{discount:String(c)}}),m=({discount:h})=>{const x=h.replace(/\D/g,"");x&&x!==String(c)&&r({itemId:n,discount:x})};return t.jsx(Q,{...i("discount"),component:"form",onBlur:h=>{const x=h.target.value.replace(/\D/g,"");x||(d("discount","0"),r({itemId:n,discount:"0"})),x&&x!==String(c)&&r({itemId:n,discount:x}),x&&x!==h.target.value&&d("discount",x)},onSubmit:p(m),variant:"standard",size:"small",sx:{"& .MuiInput-root:before":{borderBottom:"none"},"& input":{textAlign:"right"}},slotProps:{input:{type:"tel",endAdornment:t.jsx(_,{position:"end",children:t.jsx(T,{sx:{fontSize:"16px",ml:"-6px"},variant:"body2",children:"%"})}),sx:{maxWidth:"60px"}}}})},It=({item:n})=>{var m,h;const c=parseInt(n.discount,10),r=parseInt(n.quantity,10),i=((m=n.product)==null?void 0:m.price)||0,p=i-i*c/100,{mutate:d}=R();return t.jsxs(J,{variant:"elevation",sx:{p:1},children:[t.jsxs(u,{sx:{mb:2},children:[" ",(h=n.product)==null?void 0:h.name]}),t.jsx(X,{}),p===i&&t.jsxs(u,{sx:{pt:"4px",pb:"4px"},children:["Ціна:"," ",t.jsx(u,{component:"span",sx:{fontWeight:"bold"},children:i})," ","грн"]}),p!==i&&t.jsxs(u,{sx:{pt:"4px",pb:"4px",display:"flex",alignItems:"center"},children:["Ціна:",t.jsxs(u,{component:"span",sx:{ml:"4px",fontSize:"14px",position:"relative"},children:[i," грн",t.jsx(u,{sx:{position:"absolute",backgroundColor:"red",width:"calc(100% + -10px)",height:"2px",transform:"rotate(-18deg)",left:"-8px",bottom:"11px",borderRadius:"2px"}})]}),t.jsxs(u,{component:"span",sx:{fontWeight:"bold",color:"success.main",ml:"4px"},children:[p.toFixed(2)," грн"]}),t.jsxs(u,{component:"span",sx:{fontWeight:"bold",color:"primary.main",fontSize:"15px",ml:"auto"},children:[Math.ceil(i*c/100)," грн"]})]}),t.jsxs(u,{sx:{pt:"4px",pb:"4px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx(wt,{discount:c,itemId:n.itemId,fullPrice:i},`${n.itemId}:${c}:left`),t.jsx(Ot,{discount:c,itemId:n.itemId},`${n.itemId}:${c}:right`)]}),t.jsxs(u,{sx:{pt:"4px",pb:"4px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsxs(u,{children:["Кількість: ",n.quantity," шт"]}),t.jsxs(u,{children:[t.jsx(D,{size:"small",color:"secondary",disabled:r===1,onClick:()=>d({itemId:n.itemId,quantity:String(r-1)}),children:t.jsx(at,{})}),t.jsx(D,{size:"small",color:"secondary",onClick:()=>d({itemId:n.itemId,quantity:String(r+1)}),children:t.jsx(nt,{})})]})]})]})},Tt=B($),Mt=()=>t.jsxs(E,{maxWidth:"sm",sx:{height:"100vh",display:"flex",justifyContent:"space-between",flexDirection:"column"},children:[t.jsx(u,{sx:{pt:"90px",color:"text.secondary",typography:"h4",textAlign:"center"},children:t.jsx(lt,{sx:{fontSize:"140px",color:"text.secondary"}})}),t.jsx(Tt,{to:"/list",fullWidth:!0,variant:"contained",sx:{mb:"30px"},children:t.jsx(H,{color:"secondary"})})]}),Ct=()=>t.jsx(u,{sx:{display:"flex",justifyContent:"center",height:"50vh",alignItems:"center"},children:t.jsx(Z,{color:"primary"})}),Lt=({fullPrice:n,discountPrice:c,totalDiscount:r})=>t.jsxs(u,{sx:{textAlign:"center",mt:2,"@media (min-width: 1270px)":{textAlign:"left",position:"absolute",top:0,right:"8px",transform:"translateX(100%)",backgroundColor:"secondary.main",borderRadius:"4px",p:1}},children:[r>0&&t.jsxs(t.Fragment,{children:[t.jsxs(u,{children:["Разом: ",n," грн"]}),t.jsxs(u,{children:["Знижка:"," ",t.jsxs(u,{sx:{fontWeight:"bold",color:"primary.main"},component:"span",children:[r," грн"]})]})]}),t.jsxs(u,{children:["До оплати: ",c," грн"]})]}),Dt=B($),Et=()=>{const{mutate:n}=ct(),c=et(),r=st(),{data:i=[],isLoading:p}=rt(),d=i.map(l=>({...l,product:ot(l.itemId,r)})),m=d.reduce((l,e)=>{var a;const s=((a=e.product)==null?void 0:a.price)||0,o=parseInt(e.quantity,10);return l+s*o},0),h=d.reduce((l,e)=>{var g;const s=((g=e.product)==null?void 0:g.price)||0,o=parseInt(e.quantity,10),a=parseInt(e.discount,10),f=s-Math.ceil(s*a/100);return l+f*o},0),x=d.reduce((l,e)=>{var g;const s=((g=e.product)==null?void 0:g.price)||0,o=parseInt(e.quantity,10),a=parseInt(e.discount,10),f=Math.ceil(s*a/100);return l+f*o},0);return p||c?t.jsx(Ct,{}):!p&&i.length===0?t.jsx(Mt,{}):t.jsxs(t.Fragment,{children:[t.jsxs(E,{maxWidth:"md",sx:{pt:2,position:"relative"},children:[d.map(l=>t.jsx(yt,{actions:t.jsx(D,{onClick:()=>{n({itemId:l.itemId,action:"remove"})},sx:{backgroundColor:"red",borderRadius:0,width:"100%",minWidth:"80px",height:"100%"},children:t.jsx(it,{sx:{color:"white"}})}),children:t.jsx(It,{item:l})},l.itemId)),t.jsx(X,{}),t.jsx(Lt,{fullPrice:m,discountPrice:h,totalDiscount:x})]}),t.jsx(E,{maxWidth:"md",sx:{pt:2,pb:2},children:t.jsx(Dt,{to:"/list",fullWidth:!0,variant:"contained",children:t.jsx(H,{color:"secondary"})})})]})},Bt=G("/cart")({component:Et});export{Bt as Route};
