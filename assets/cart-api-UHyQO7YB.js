import{f as I,u as m,e as v}from"./tanstack-DrrzDSOT.js";import{J as h,K as w,M as d,O as $}from"./index-DfonmTDt.js";const u=h(),c=w(),y="cart",f={itemId:"A",discount:"B",quantity:"C",cartId:"D"},p=async s=>{if(!u||!c)return[];const a=`https://sheets.googleapis.com/v4/spreadsheets/${u}/values/${y}?key=${c}`;return(await(await fetch(a,{signal:s})).json()).values.slice(1).map(r=>({itemId:r[0],discount:r[1],quantity:r[2],cartId:r[3]}))},g=async(s,a,e)=>{const n=(await p()).findIndex(r=>r.itemId===s);if(n!==-1){const r={values:[[e]]},o=`${y}!${f[a]}${n+2}`,l=`https://sheets.googleapis.com/v4/spreadsheets/${u}/values/${o}?valueInputOption=RAW&key=${c}`;await d(l,{body:JSON.stringify(r),method:"PUT"})}},q=async s=>{const e=(await p()).findIndex(t=>t.itemId===s);if(e!==-1){const t=`${y}!A${e+2}:F${e+2}`,n=`https://sheets.googleapis.com/v4/spreadsheets/${u}/values/${t}:clear?key=${c}`;await d(n,{method:"POST"})}},C=async s=>{const a=await p(),e=a.findIndex(t=>t.itemId===s);if(e===-1){const t={values:[[s,"0","1","1"]]},n=`${y}!A1`,r=`https://sheets.googleapis.com/v4/spreadsheets/${u}/values/${n}:append?valueInputOption=RAW&key=${c}`;await d(r,{body:JSON.stringify(t),method:"POST"})}else{const t=a[e],r={values:[[parseInt(t.quantity,10)+1]]},o=`${y}!${f.quantity}${e+2}`,l=`https://sheets.googleapis.com/v4/spreadsheets/${u}/values/${o}?valueInputOption=RAW&key=${c}`;await d(l,{body:JSON.stringify(r),method:"PUT"})}},i=()=>[$],A=()=>I({staleTime:1e3*60*35,queryKey:i(),queryFn:({signal:s})=>p(s).then(a=>a.filter(e=>!!e.itemId))}),E=()=>{const s=m();return v({async onSettled(){return await s.invalidateQueries({queryKey:i()})},onMutate:async({itemId:a,quantity:e,discount:t})=>{await s.cancelQueries({queryKey:i()});const n=s.getQueryData(i())||[],r=n.map(o=>o.itemId!==a?o:{...o,quantity:e!==void 0?e:o.quantity,discount:t!==void 0?t:o.discount});return s.setQueryData(i(),r),{list:n}},onError:(a,e,t)=>{s.setQueryData([i()],t==null?void 0:t.list)},mutationFn:async({discount:a,quantity:e,itemId:t})=>{a!==void 0&&await g(t,"discount",a),e!==void 0&&await g(t,"quantity",e)}})},_=()=>{const s=m();return v({async onSettled(){return await s.invalidateQueries({queryKey:[$]})},onMutate:async({itemId:a,action:e})=>{await s.cancelQueries({queryKey:i()});const t=s.getQueryData(i())||[];return e==="remove"&&s.setQueryData(i(),n=>n==null?void 0:n.filter(r=>r.itemId!==a)),e==="add"&&s.setQueryData(i(),n=>(n==null?void 0:n.find(o=>o.itemId===a))?n:[...n||[],{itemId:a,quantity:"1",discount:"0",cartId:"1"}]),{list:t}},onError:(a,e,t)=>{s.setQueryData([i()],t==null?void 0:t.list)},mutationFn:({itemId:a,action:e})=>e==="add"?C(a):e==="remove"?q(a):Promise.resolve()})};export{_ as a,A as b,E as u};
