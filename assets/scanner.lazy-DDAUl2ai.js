import{j as t,L as C,i as $}from"./tanstack-BBDN94cF.js";import{r as a}from"./react-LZ_8jTT_.js";import{r as y,s as B}from"./index-CRjVwLRH.js";import"./html2canvas-BfYXEYrK.js";import{i as w,B as r,n as D,I as O,f as R,E as q,j as P}from"./mui-jgIl-f2a.js";var b={},U=w;Object.defineProperty(b,"__esModule",{value:!0});var I=b.default=void 0,V=U(y()),k=t;I=b.default=(0,V.default)([(0,k.jsx)("circle",{cx:"12",cy:"12",r:"3.2"},"0"),(0,k.jsx)("path",{d:"M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5"},"1")],"CameraAlt");var S={},X=w;Object.defineProperty(S,"__esModule",{value:!0});var E=S.default=void 0,A=X(y()),F=t;E=S.default=(0,A.default)((0,F.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search");const j=140,g=32,T=async()=>await B.createWorker(["ukr","eng"],1),Y=async()=>{try{return await navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment"}})}catch{return await navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"user"}})}},G=e=>{const d=e.videoWidth,l=e.videoHeight,u=e.clientWidth,x=e.clientHeight,p=u/d,f=x/l,m=j*p,h=g*f,v=(u-j)/2,o=(x-g)/2-120;return{x:v,y:o,width:m,height:h}},J=({cropArea:e,output:d})=>t.jsx(r,{sx:{position:"absolute",left:e.x,top:e.y+g+30,zIndex:1,minWidth:e.width},children:t.jsx(D,{sx:{pl:"4px",pr:"4px"},children:d})}),K=({cropArea:e})=>t.jsxs(r,{width:"100%",height:"100%",component:"svg",sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none"},children:[t.jsx("defs",{children:t.jsxs("mask",{id:"mask",children:[t.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"white"}),t.jsx("rect",{x:e.x,y:e.y,width:e.width,height:e.height,fill:"black"})]})}),t.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",mask:"url(#mask)",fill:"rgba(0, 0, 0, 0.5)"})]}),N=({cropArea:e})=>t.jsx(r,{sx:{position:"absolute",border:"1px solid",borderColor:"primary.main",boxSizing:"border-box",pointerEvents:"none",left:e.x,top:e.y,width:e.width,height:e.height}});var _={},Q=w;Object.defineProperty(_,"__esModule",{value:!0});var M=_.default=void 0,Z=Q(y()),tt=t;M=_.default=(0,Z.default)((0,tt.jsx)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack");const et=()=>t.jsx(O,{component:C,to:"/",sx:{zIndex:1,position:"absolute",top:"15px",left:"15px",color:"primary.main"},children:t.jsx(M,{})}),it=()=>{const[e,d]=a.useState(!1),[l,u]=a.useState(""),[x,p]=a.useState(!1),[f,m]=a.useState(null),h=a.useRef(null),v=a.useRef(null),[o,z]=a.useState({x:0,y:0,width:j,height:g});a.useEffect(()=>{const s=(async()=>{try{const i=await Y(),c=h.current;return c&&(c.srcObject=i,c.onloadedmetadata=()=>{c.play(),z(G(c)),d(!0)}),i}catch(i){console.error("Error accessing webcam: ",i),m(i==null?void 0:i.toString())}})();return()=>{s.then(i=>{i&&i.getTracks().forEach(c=>c.stop())})}},[]);const W=()=>{const n=v.current,s=h.current;if(n&&s){const i=n.getContext("2d");n.width=s.videoWidth,n.height=s.videoHeight,i&&(i.drawImage(s,0,0,n.width,n.height),H(n.toDataURL("image/jpeg")))}},H=async n=>{p(!0);try{const s=await T(),{data:{text:i}}=await s.recognize(n,{rectangle:{top:o.y,left:o.x,width:o.width,height:o.height}});u(i.trim()),await s.terminate()}catch(s){console.log("## e",s)}p(!1)},L=t.jsxs(r,{sx:{position:"absolute",bottom:"80px",left:"50%",transform:"translateX(-50%)",zIndex:1,display:"flex",gap:"20px"},children:[t.jsx(R,{variant:"contained",onClick:W,disabled:x,children:t.jsx(I,{})}),t.jsx(R,{component:C,to:"/",search:l.length?{s:l}:{},variant:"contained",children:t.jsx(E,{})})]});return t.jsxs(r,{sx:{overflow:"hidden",position:"relative"},children:[!!f&&t.jsx(r,{sx:{p:3,position:"absolute",top:"200px"},children:t.jsx(q,{severity:"error",children:f.toString()})}),!e&&t.jsx(r,{sx:{position:"absolute",top:"0",height:"150px",width:"100%",display:"flex",alignItems:"flex-end",justifyContent:"center"},children:t.jsx(P,{sx:{color:"primary.main"}})}),t.jsx(et,{}),e&&L,t.jsx(r,{sx:{display:"flex",justifyContent:"center"},children:t.jsxs(r,{sx:{position:"relative"},children:[e&&t.jsx(J,{cropArea:o,output:l}),e&&t.jsx(K,{cropArea:o}),e&&t.jsx(N,{cropArea:o}),t.jsx(r,{component:"video",ref:h,playsInline:!0,muted:!0,sx:{visibility:e?"visible":"hidden"}})]})}),t.jsx(r,{component:"canvas",ref:v,sx:{display:"none"}})]})},ct=$("/scanner")({component:it});export{ct as Route};
