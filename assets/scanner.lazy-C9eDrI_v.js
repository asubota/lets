import{j as t,L as w,m as R}from"./tanstack-BOdhr6Pk.js";import{r as a}from"./react-BtIrUdbE.js";import{s as E,S as H}from"./index-BePQn9hP.js";import"./html2canvas-BfYXEYrK.js";import{a as b,B as i,m as W,I as z,f as y,H as B,h as L}from"./mui-CnM2NOip.js";const M=b(t.jsx("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack"),O=b([t.jsx("circle",{cx:"12",cy:"12",r:"3.2"},"0"),t.jsx("path",{d:"M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5"},"1")],"CameraAlt"),v=140,f=32,D=async()=>await E.createWorker(["ukr","eng"],1),U=async()=>{try{return await navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment"}})}catch{return await navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"user"}})}},V=e=>{const d=e.videoWidth,l=e.videoHeight,x=e.clientWidth,p=e.clientHeight,u=x/d,g=p/l,j=v*u,h=f*g,m=(x-v)/2,r=(p-f)/2-120;return{x:m,y:r,width:j,height:h}},P=({cropArea:e,output:d})=>t.jsx(i,{sx:{position:"absolute",left:e.x,top:e.y+f+30,zIndex:1,minWidth:e.width},children:t.jsx(W,{sx:{pl:"4px",pr:"4px"},children:d})}),X=({cropArea:e})=>t.jsxs(i,{component:"svg",sx:{width:"100%",height:"100%",position:"absolute",top:0,left:0,pointerEvents:"none"},children:[t.jsx("defs",{children:t.jsxs("mask",{id:"mask",children:[t.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"white"}),t.jsx("rect",{x:e.x,y:e.y,width:e.width,height:e.height,fill:"black"})]})}),t.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",mask:"url(#mask)",fill:"rgba(0, 0, 0, 0.5)"})]}),_=({cropArea:e})=>t.jsx(i,{sx:{position:"absolute",border:"1px solid",borderColor:"primary.main",boxSizing:"border-box",pointerEvents:"none",left:e.x,top:e.y,width:e.width,height:e.height}}),A=()=>t.jsx(z,{component:w,to:"/",sx:{zIndex:1,position:"absolute",top:"15px",left:"15px",color:"primary.main"},children:t.jsx(M,{})}),F=()=>{const[e,d]=a.useState(!1),[l,x]=a.useState(""),[p,u]=a.useState(!1),[g,j]=a.useState(null),h=a.useRef(null),m=a.useRef(null),[r,k]=a.useState({x:0,y:0,width:v,height:f});a.useEffect(()=>{const n=(async()=>{try{const s=await U(),c=h.current;return c&&(c.srcObject=s,c.onloadedmetadata=()=>{c.play(),k(V(c)),d(!0)}),s}catch(s){console.error("Error accessing webcam: ",s),j(s==null?void 0:s.toString())}})();return()=>{n.then(s=>{s&&s.getTracks().forEach(c=>c.stop())})}},[]);const S=()=>{const o=m.current,n=h.current;if(o&&n){const s=o.getContext("2d");o.width=n.videoWidth,o.height=n.videoHeight,s&&(s.drawImage(n,0,0,o.width,o.height),C(o.toDataURL("image/jpeg")))}},C=async o=>{u(!0);try{const n=await D(),{data:{text:s}}=await n.recognize(o,{rectangle:{top:r.y,left:r.x,width:r.width,height:r.height}});x(s.trim()),await n.terminate()}catch(n){console.log("## e",n)}u(!1)},I=t.jsxs(i,{sx:{position:"absolute",bottom:"80px",left:"50%",transform:"translateX(-50%)",zIndex:1,display:"flex",gap:"20px"},children:[t.jsx(y,{variant:"contained",onClick:S,disabled:p,children:t.jsx(O,{})}),t.jsx(y,{component:w,to:"/",search:l.length?{s:l}:{},variant:"contained",children:t.jsx(H,{})})]});return t.jsxs(i,{sx:{overflow:"hidden",position:"relative"},children:[!!g&&t.jsx(i,{sx:{p:3,position:"absolute",top:"200px"},children:t.jsx(B,{severity:"error",children:g.toString()})}),!e&&t.jsx(i,{sx:{position:"absolute",top:"0",height:"150px",width:"100%",display:"flex",alignItems:"flex-end",justifyContent:"center"},children:t.jsx(L,{sx:{color:"primary.main"}})}),t.jsx(A,{}),e&&I,t.jsx(i,{sx:{display:"flex",justifyContent:"center"},children:t.jsxs(i,{sx:{position:"relative"},children:[e&&t.jsx(P,{cropArea:r,output:l}),e&&t.jsx(X,{cropArea:r}),e&&t.jsx(_,{cropArea:r}),t.jsx(i,{component:"video",ref:h,playsInline:!0,muted:!0,sx:{visibility:e?"visible":"hidden"}})]})}),t.jsx(i,{component:"canvas",ref:m,sx:{display:"none"}})]})},K=R("/scanner")({component:F});export{K as Route};
